<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>01 – System Overview</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 48px 48px 60px;
    background: #fff;
    font-family: 'Space Grotesk', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  .page-label {
    font-family: 'Roboto Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.12em;
    color: #888;
    margin-bottom: 8px;
  }
  h1 {
    font-family: 'Roboto Mono', monospace;
    font-weight: 400;
    font-size: 1.4rem;
    letter-spacing: -0.02em;
    margin: 0 0 48px;
    color: #000;
  }
</style>
</head>
<body>
<div class="page-label">ALLIANDER SCENARIO PLANNING TOOL — ARCHITECTURE</div>
<h1>01 — System Overview</h1>

<svg width="980" height="510" xmlns="http://www.w3.org/2000/svg" style="display:block;">
  <defs>
    <marker id="ab" markerWidth="9" markerHeight="9" refX="7" refY="3.5" orient="auto">
      <path d="M0,0 L0,7 L9,3.5 z" fill="#0000FF"/>
    </marker>
    <marker id="ag" markerWidth="9" markerHeight="9" refX="7" refY="3.5" orient="auto">
      <path d="M0,0 L0,7 L9,3.5 z" fill="#888"/>
    </marker>
    <marker id="ap" markerWidth="9" markerHeight="9" refX="7" refY="3.5" orient="auto">
      <path d="M0,0 L0,7 L9,3.5 z" fill="#7877f6"/>
    </marker>
    <style>
      text { font-family: 'Space Grotesk', sans-serif; }
      .mono { font-family: 'Roboto Mono', monospace; }
      .lbl { font-size: 11px; fill: #fff; font-family: 'Roboto Mono', monospace; font-weight: 500; letter-spacing: 0.06em; }
      .lbl-dark { font-size: 11px; fill: #000; font-family: 'Roboto Mono', monospace; font-weight: 500; letter-spacing: 0.06em; }
      .small { font-size: 10px; fill: #888; }
      .body { font-size: 10px; fill: #222; }
      .mono-sm { font-family: 'Roboto Mono', monospace; font-size: 10px; fill: #000; }
      .chip-text { font-family: 'Roboto Mono', monospace; font-size: 9px; fill: #333; }
    </style>
  </defs>

  <!-- ═══════════ BROWSER BOX ═══════════ -->
  <rect x="20" y="60" width="188" height="330" fill="#fff" stroke="#000" stroke-width="2"/>
  <rect x="20" y="60" width="188" height="32" fill="#000"/>
  <text x="114" y="81" text-anchor="middle" class="lbl">BROWSER / FRONTEND</text>

  <text x="36" y="113" class="small">index.html — single HTML file (SPA)</text>

  <!-- Moderator sub-box -->
  <rect x="32" y="124" width="164" height="48" fill="#f5f5f5" stroke="#e5e5e5" stroke-width="1"/>
  <text x="40" y="140" class="small">MODERATOR</text>
  <text x="40" y="158" class="body">Controls the session</text>

  <!-- Viewer sub-box -->
  <rect x="32" y="180" width="164" height="48" fill="#f5f5f5" stroke="#e5e5e5" stroke-width="1"/>
  <text x="40" y="196" class="small">VIEWER(S)</text>
  <text x="40" y="214" class="body">Follow via session code</text>

  <line x1="32" y1="242" x2="196" y2="242" stroke="#e5e5e5" stroke-width="1"/>

  <text x="36" y="263" class="small">Reads &amp; writes:</text>
  <text x="36" y="281" class="mono-sm">sessions</text>
  <text x="36" y="299" class="small">Subscribes to:</text>
  <text x="36" y="317" class="mono-sm">Realtime channel</text>
  <text x="36" y="335" class="small">per session ID</text>
  <text x="36" y="360" class="small">No build step · No framework</text>
  <text x="36" y="378" class="small">Deployed as static file on Vercel</text>


  <!-- ═══════════ VERCEL BOX ═══════════ -->
  <rect x="340" y="130" width="210" height="210" fill="#fff" stroke="#000" stroke-width="2"/>
  <rect x="340" y="130" width="210" height="32" fill="#000"/>
  <text x="445" y="151" text-anchor="middle" class="lbl">VERCEL SERVERLESS</text>

  <text x="356" y="182" class="mono-sm">api/generate.js</text>

  <text x="356" y="204" class="small">① Receive promptId + sessionData</text>
  <text x="356" y="222" class="small">② Fetch prompt template from DB</text>
  <text x="356" y="240" class="small">③ Fetch sector context data</text>
  <text x="356" y="258" class="small">④ Fill template with variables</text>
  <text x="356" y="276" class="small">⑤ Call Gemini AI</text>
  <text x="356" y="294" class="small">⑥ Stream response back via SSE</text>
  <text x="356" y="325" class="small" style="fill:#bbb;">Max duration: 120s</text>


  <!-- ═══════════ GEMINI BOX ═══════════ -->
  <rect x="672" y="54" width="210" height="118" fill="#fff" stroke="#000" stroke-width="2"/>
  <rect x="672" y="54" width="210" height="32" fill="#daf13e"/>
  <text x="777" y="75" text-anchor="middle" class="lbl-dark">GOOGLE GEMINI AI</text>

  <text x="688" y="108" class="mono-sm">gemini-3-flash-preview</text>
  <text x="688" y="128" class="small">Large language model</text>
  <text x="688" y="146" class="small">Streams generated text via SSE</text>


  <!-- ═══════════ SUPABASE BOX ═══════════ -->
  <rect x="672" y="248" width="210" height="220" fill="#fff" stroke="#000" stroke-width="2"/>
  <rect x="672" y="248" width="210" height="32" fill="#7877f6"/>
  <text x="777" y="269" text-anchor="middle" class="lbl">SUPABASE</text>

  <text x="688" y="302" class="small">Database tables:</text>

  <!-- Chips -->
  <rect x="688" y="311" width="62" height="20" rx="10" fill="#f0f0f0" stroke="#e0e0e0" stroke-width="1"/>
  <text x="719" y="325" text-anchor="middle" class="chip-text">sessions</text>

  <rect x="758" y="311" width="54" height="20" rx="10" fill="#f0f0f0" stroke="#e0e0e0" stroke-width="1"/>
  <text x="785" y="325" text-anchor="middle" class="chip-text">prompts</text>

  <rect x="688" y="340" width="186" height="20" rx="10" fill="#f0f0f0" stroke="#e0e0e0" stroke-width="1"/>
  <text x="781" y="354" text-anchor="middle" class="chip-text">technology_sector_analyses</text>

  <rect x="688" y="369" width="100" height="20" rx="10" fill="#f0f0f0" stroke="#e0e0e0" stroke-width="1"/>
  <text x="738" y="383" text-anchor="middle" class="chip-text">sector_profile</text>

  <line x1="688" y1="404" x2="868" y2="404" stroke="#e5e5e5" stroke-width="1"/>

  <text x="688" y="424" class="small">Realtime WebSocket channels</text>
  <text x="688" y="442" class="small">for live moderator → viewer sync</text>
  <text x="688" y="460" class="small">Hosted · Managed PostgreSQL</text>


  <!-- ═══════════ ARROWS ═══════════ -->

  <!-- 1. Browser → Vercel: POST /api/generate -->
  <line x1="210" y1="218" x2="338" y2="218" stroke="#0000FF" stroke-width="1.5" marker-end="url(#ab)"/>
  <text x="274" y="212" text-anchor="middle" style="font-size:9px; fill:#0000FF; font-family:'Space Grotesk',sans-serif;">POST /api/generate</text>

  <!-- 2. Vercel → Browser: SSE stream -->
  <line x1="338" y1="252" x2="210" y2="252" stroke="#0000FF" stroke-width="1.5" marker-end="url(#ab)"/>
  <text x="274" y="268" text-anchor="middle" style="font-size:9px; fill:#0000FF; font-family:'Space Grotesk',sans-serif;">← SSE stream</text>

  <!-- 3. Vercel → Gemini: HTTP API call (orthogonal path going right then up) -->
  <path d="M 552,178 L 620,178 L 620,113 L 670,113" fill="none" stroke="#888" stroke-width="1.5" marker-end="url(#ag)"/>
  <text x="616" y="149" text-anchor="middle" style="font-size:9px; fill:#888; font-family:'Space Grotesk',sans-serif; writing-mode:tb;">HTTP API</text>

  <!-- 4. Vercel → Supabase: fetch context (orthogonal path going right then down) -->
  <path d="M 552,296 L 620,296 L 620,330 L 670,330" fill="none" stroke="#888" stroke-width="1.5" marker-end="url(#ag)"/>
  <text x="600" y="316" text-anchor="middle" style="font-size:9px; fill:#888; font-family:'Space Grotesk',sans-serif;">fetch context</text>

  <!-- 5. Browser ↔ Supabase: Realtime + sessions (path below all boxes) -->
  <path d="M 114,392 L 114,488 L 777,488 L 777,470" fill="none" stroke="#7877f6" stroke-width="1.5" stroke-dasharray="6,3" marker-end="url(#ap)"/>
  <rect x="320" y="476" width="244" height="18" fill="#fff"/>
  <text x="442" y="489" text-anchor="middle" style="font-size:9px; fill:#7877f6; font-family:'Space Grotesk',sans-serif;">sessions R/W  ·  Realtime WebSocket (live sync)</text>

</svg>

</body>
</html>
